# 故障排除指南

## 常见问题

### 1. 环境变量问题
#### 症状
- 部署失败，提示环境变量或 secret 不存在
- 环境变量无法正确读取

#### 解决方案
1. 检查语法
   - 确保 vercel.json 使用 ${} 语法
   - 不要混用 @secret 语法

2. 验证配置
   - 使用 vercel env ls 检查环境变量
   - 确认变量名称完全匹配

### 2. 部署失败
#### 症状
- 构建失败
- 部署超时
- 环境配置错误

#### 解决方案
1. 检查项目关联
   ```bash
   vercel link
   ```

2. 验证配置文件
   - 检查 vercel.json 语法
   - 确认构建命令正确

3. 环境变量设置
   - 重新配置环境变量
   - 验证变量值正确

### 3. 配置不一致问题
#### 症状
- 环境变量设置正确但 API 调用 404
- 部署成功但功能不可用
- 本地开发和生产环境行为不一致

#### 原因分析
1. 配置分散
   - 环境变量在多处定义
   - 使用不同的引用方式
   - 配置文件之间不同步

2. 模块系统混用
   - ES Modules 和 CommonJS 混用
   - 导入导出方式不统一

#### 解决方案
1. 统一环境变量
   - 使用 process.env 访问
   - 统一使用 ${} 语法
   - 移除自定义配置文件

2. 统一模块系统
   - 使用 ES Modules
   - 更新导入导出语法

3. 优化部署配置
   - 调整路由顺序
   - 添加静态文件支持
   - 完善错误处理

## 最佳实践
1. 始终使用一种部署方式
2. 遵循统一的配置语法
3. 保持文档更新

### 4. MVP 阶段建议
#### 开发原则
- 保持代码简单直接
- 避免复杂的模块系统
- 优先验证核心功能

#### 常见问题
1. 代码组织
   - 将相关代码放在一起
   - 避免过度拆分
   - 保持直观易懂

2. 部署问题
   - 使用最简配置
   - 减少依赖项
   - 简化部署流程

3. 功能取舍
   - 专注核心功能
   - 避免过度优化
   - 快速迭代验证 