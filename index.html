<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="DeepSeek Image Generator - Transform your ideas into beautiful images. Support multiple artistic styles, generate high-quality AI images with one click.">
    <meta name="keywords" content="AI Art,DeepSeek,Image Generation,AI Art,Artificial Intelligence">
    <meta name="author" content="DeepSeek">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-domain.com/">
    <meta property="og:title" content="DeepSeek Image Generator">
    <meta property="og:description" content="Transform your ideas into beautiful images. Support multiple artistic styles, generate high-quality AI images with one click.">
    <meta property="og:image" content="https://your-domain.com/og-image.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://your-domain.com/">
    <meta property="twitter:title" content="DeepSeek Image Generator">
    <meta property="twitter:description" content="Transform your ideas into beautiful images. Support multiple artistic styles, generate high-quality AI images with one click.">
    <meta property="twitter:image" content="https://your-domain.com/og-image.jpg">
    <title>DeepSeek Image Generator</title>
    <link rel="stylesheet" href="src/styles/main.css">
    <script>
      // Global configuration
      const CONFIG = {
        API_URL: 'https://api.siliconflow.cn/v1/images/generations',
        MAX_LENGTH: 1000,
        STYLES: {
          photo: { name: 'Photo Style' },
          art: { name: 'Art Style' },
          cartoon: { name: 'Cartoon Style' }
        }
      };

      // Initialize after page load
      window.onload = function() {
        // Get DOM elements
        const promptInput = document.getElementById('prompt-input');
        const styleSelect = document.getElementById('style-select');
        const generateBtn = document.getElementById('generate-btn');
        const imageContainer = document.getElementById('image-container');
        const downloadBtn = document.getElementById('download-btn');
        const placeholder = document.querySelector('.placeholder');
        const progressContainer = imageContainer.querySelector('.progress-container');
        const resultImage = imageContainer.querySelector('.result-image');
        const charCount = document.querySelector('.char-count');

        // Update character count
        promptInput.addEventListener('input', function() {
          const count = this.value.length;
          charCount.textContent = `${count}/${CONFIG.MAX_LENGTH}`;
        });

        // Generate image function
        async function generateImage() {
          const maxRetries = 2;
          const timeout = 30000;
          
          try {
            generateBtn.disabled = true;
            // Show loading state
            placeholder.style.display = 'block';
            placeholder.innerHTML = `
              <div class="loading-status">
                <div class="spinner"></div>
                <p>Generating your image...</p>
              </div>
            `;
            resultImage.innerHTML = '';
            
            // Show progress bar
            progressContainer.style.display = 'block';
            const progressBar = progressContainer.querySelector('.progress-bar');
            progressBar.style.width = '0%';
            
            // Add timeout control
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            // Fetch with retry function
            async function fetchWithRetry(retries = 0) {
              try {
                const response = await fetch('/api/generate', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    prompt: promptInput.value,
                    style: styleSelect.value
                  }),
                  signal: controller.signal
                });
                
                if (!response.ok) {
                  const errorData = await response.json();
                  throw new Error(errorData.error || `Server error: ${response.status}`);
                }
                
                return await response.json();
              } catch (error) {
                if (retries < maxRetries) {
                  console.log(`Retrying... (${retries + 1}/${maxRetries})`);
                  return await fetchWithRetry(retries + 1);
                }
                throw error;
              }
            }
            
            const data = await fetchWithRetry();
            clearTimeout(timeoutId);
            
            // Hide progress bar
            progressContainer.style.display = 'none';
            
            // Show generated image
            const img = document.createElement('img');
            img.src = data.url;
            img.alt = promptInput.value;
            img.onload = function() {
              placeholder.style.display = 'none';
              resultImage.style.display = 'block';
            };
            img.onerror = function() {
              console.error('Image load failed');
              showError('Image Load Error', 'Failed to load the generated image. Please try again.');
            };
            resultImage.appendChild(img);
            
            // Show download button
            downloadBtn.style.display = 'block';
            
          } catch (error) {
            console.error('Generation error:', error);
            let title = 'Generation Error';
            let message = 'Failed to generate image. ';
            if (error.name === 'AbortError') {
              message += 'Request timed out. Please try again.';
            } else {
              message += error.message;
            }
            showError(title, message);
          } finally {
            generateBtn.disabled = false;
            progressContainer.style.display = 'none';
          }
        }
        
        // Bind generate button event
        generateBtn.addEventListener('click', generateImage);
        
        // Show error message
        function showError(title, message) {
          placeholder.innerHTML = `
            <div class="error-container">
              <h3>${title}</h3>
              <p>${message}</p>
            </div>
          `;
        }
      };
    </script>
</head>
<body>
    <main>
        <!-- Input Section -->
        <section class="input-section">
            <textarea class="prompt-input" 
                      placeholder="Enter your image description (50-1000 characters)"></textarea>
            <div class="style-selector">
                <button class="style-btn" data-style="photo">Photo Style</button>
                <button class="style-btn" data-style="cartoon">Cartoon Style</button>
                <button class="style-btn" data-style="art">Art Style</button>
            </div>
        </section>

        <!-- Control Section -->
        <section class="control-section">
            <button class="generate-btn">Generate Image</button>
            <div class="loading-indicator" hidden>Generating...</div>
        </section>

        <!-- Output Section -->
        <section class="output-section">
            <div class="image-preview" hidden></div>
            <div class="error-message" hidden></div>
        </section>
    </main>

    <footer class="footer">
        <p>Â© 2024 DeepSeek Image Generator - <a href="/privacy.html">Privacy Policy</a> - <a href="/terms.html">Terms of Use</a></p>
    </footer>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "DeepSeek Image Generator",
      "description": "AI-powered image generation tool built with DeepSeek API. Create high-quality images in various artistic styles.",
      "applicationCategory": "Image Generation Tool",
      "operatingSystem": "All",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>
</body>
</html> 